# 个人信息修改测试指南

## 📋 功能说明

医疗系统提供了修改患者和医生个人信息的功能，可以通过JSON请求更新数据库中的信息。

## 🔧 测试程序

### 1. `test_update_info.py` - 完整测试程序
包含所有测试场景的详细测试程序：
- ✅ 修改患者信息（姓名、生日、身份证、手机、邮箱）
- ✅ 修改医生信息（姓名、工号、科室、费用、工作时间等）
- ✅ 错误处理测试（不存在的用户、缺少参数等）
- ✅ 修改结果验证

### 2. `test_simple_update.py` - 快速测试程序
简化版本，适合快速验证功能：
- 🚀 快速修改患者信息
- 🚀 快速修改医生信息
- 🚀 自动验证修改结果

## 🚀 使用方法

### 运行完整测试
```bash
python test_update_info.py
```

### 运行快速测试
```bash
python test_simple_update.py
```

## 📊 API 接口说明

### 修改患者信息
```json
{
  "reset_patient_information": true,
  "old_phone": "原手机号",           // 必需：用于查找患者
  "new_name": "新姓名",             // 可选
  "new_birth_date": "1990-01-01",  // 可选：新生日
  "new_id_card": "新身份证号",       // 可选
  "new_phone": "新手机号",          // 可选
  "new_email": "新邮箱"             // 可选
}
```

### 修改医生信息
```json
{
  "reset_doctor_information": true,
  "old_employee_id": "原工号",        // 必需：用于查找医生
  "new_name": "新姓名",              // 可选
  "new_employee_id": "新工号",       // 可选
  "new_department": "新科室",        // 可选
  "new_max_patients": 30,           // 可选：最大患者数
  "new_fee": 80.0,                  // 可选：费用
  "new_work_schedule": "工作时间JSON", // 可选
  "new_is_available": true,         // 可选：是否可用
  "new_photo_path": "头像路径"       // 可选
}
```

## 📝 默认测试数据

### 患者数据
| 姓名 | 手机号 | 邮箱 |
|------|--------|------|
| 张三 | 13800138000 | zhangsan@example.com |
| 李四 | 13900139000 | lisi@example.com |
| 王五 | 15800158000 | wangwu@example.com |

### 医生数据
| 姓名 | 工号 | 科室 | 费用 |
|------|------|------|------|
| 王医生 | DOC001 | 内科 | 50.0 |
| 刘医生 | DOC002 | 外科 | 80.0 |
| 陈医生 | DOC003 | 儿科 | 60.0 |

## ✅ 测试场景

### 正常修改测试
1. **修改患者部分信息**：姓名和邮箱
2. **修改患者全部信息**：所有可修改字段
3. **修改医生部分信息**：姓名和科室
4. **修改医生费用设置**：费用和最大患者数

### 错误处理测试
1. **不存在的用户**：使用不存在的手机号/工号
2. **缺少必需参数**：不提供 old_phone 或 old_employee_id
3. **无更新字段**：只有识别参数，没有更新字段

### 验证测试
1. **查询修改后的信息**：确认修改是否生效
2. **外键更新验证**：手机号/工号修改时 users 表同步更新

## ⚠️ 注意事项

1. **服务器状态**：确保服务器在 `8.140.225.6:55000` 运行
2. **数据依赖**：测试使用默认示例数据，确保数据库已初始化
3. **手机号唯一性**：修改手机号时注意不要与现有数据冲突
4. **工号唯一性**：修改工号时注意不要与现有数据冲突

## 🔧 故障排除

### 连接失败
```bash
# 检查服务器状态
python integrated_server_loginmatchAdd.py status

# 重启服务器
python integrated_server_loginmatchAdd.py restart
```

### 数据问题
```bash
# 查看数据库状态
python check_database.py MedicalSystem.db

# 重置数据库（如果需要）
python check_database.py --reset
```

### 测试数据不匹配
如果默认数据发生变化，请：
1. 先运行查询测试确认当前数据
2. 修改测试程序中的手机号/工号
3. 重新运行测试

## 📈 预期结果

### 成功响应
```json
{
  "status": "success",
  "timestamp": "2024-02-01T10:00:00",
  "result": "患者ID为X的患者信息更新成功"
}
```

### 错误响应
```json
{
  "status": "success",
  "timestamp": "2024-02-01T10:00:00", 
  "result": "错误: 未找到手机号为XXX的患者"
}
```

## 🎯 测试建议

1. **先运行简单测试**：快速验证基本功能
2. **再运行完整测试**：全面验证所有场景
3. **查看服务器日志**：了解详细执行情况
4. **分步骤测试**：如有问题，逐个功能测试

