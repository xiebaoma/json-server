<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç–—ç³»ç»ŸAPIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #34495e;
            margin-top: 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .response {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .server-info {
            background-color: #d1ecf1;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #bee5eb;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ åŒ»ç–—ç³»ç»ŸAPIæµ‹è¯•é¡µé¢</h1>
        
        <div class="server-info">
            <h3>ğŸ“¡ æœåŠ¡å™¨ä¿¡æ¯</h3>
            <p><strong>åœ°å€:</strong> 8.140.225.6:55000</p>
            <p><strong>åè®®:</strong> TCP Socket + JSON</p>
            <p><strong>çŠ¶æ€:</strong> <span id="serverStatus">æœªè¿æ¥</span></p>
        </div>
        
        <div class="grid">
            <!-- ç”¨æˆ·ç™»å½• -->
            <div class="section">
                <h2>ğŸ” ç”¨æˆ·ç™»å½•</h2>
                <div class="form-group">
                    <label>ç”¨æˆ·å:</label>
                    <input type="text" id="loginUsername" value="13800138000" placeholder="æ‰‹æœºå·æˆ–å·¥å·">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="password" id="loginPassword" value="hash_patient1" placeholder="å¯†ç ">
                </div>
                <button onclick="testLogin()">ç™»å½•</button>
                <div id="loginResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- æŸ¥è¯¢åŒ»ç”Ÿä¿¡æ¯ -->
            <div class="section">
                <h2>ğŸ‘¨â€âš•ï¸ æŸ¥è¯¢åŒ»ç”Ÿä¿¡æ¯</h2>
                <div class="form-group">
                    <label>åŒ»ç”Ÿå§“å:</label>
                    <input type="text" id="doctorName" value="ç‹åŒ»ç”Ÿ" placeholder="åŒ»ç”Ÿå§“å">
                </div>
                <button onclick="queryDoctor()">æŸ¥è¯¢åŒ»ç”Ÿ</button>
                <div id="doctorResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- åˆ›å»ºé¢„çº¦ -->
            <div class="section">
                <h2>ğŸ“… åˆ›å»ºé¢„çº¦</h2>
                <div class="form-group">
                    <label>æ‚£è€…æ‰‹æœºå·:</label>
                    <input type="text" id="patientPhone" value="13800138000" placeholder="æ‚£è€…æ‰‹æœºå·">
                </div>
                <div class="form-group">
                    <label>åŒ»ç”Ÿå§“å:</label>
                    <input type="text" id="appointmentDoctor" value="ç‹åŒ»ç”Ÿ" placeholder="åŒ»ç”Ÿå§“å">
                </div>
                <div class="form-group">
                    <label>é¢„çº¦æ—¶é—´:</label>
                    <input type="datetime-local" id="appointmentTime" value="2024-03-15T10:00">
                </div>
                <div class="form-group">
                    <label>æ˜¯å¦å·²ä»˜è´¹:</label>
                    <select id="feePaid">
                        <option value="1">å·²ä»˜è´¹</option>
                        <option value="0">æœªä»˜è´¹</option>
                    </select>
                </div>
                <button onclick="createAppointment()">åˆ›å»ºé¢„çº¦</button>
                <div id="appointmentResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- æŸ¥è¯¢é¢„çº¦ -->
            <div class="section">
                <h2>ğŸ” æŸ¥è¯¢é¢„çº¦</h2>
                <div class="form-group">
                    <label>æŸ¥è¯¢æ–¹å¼:</label>
                    <select id="queryType" onchange="toggleQueryFields()">
                        <option value="phone">æŒ‰æ‚£è€…æ‰‹æœºå·</option>
                        <option value="doctor">æŒ‰åŒ»ç”Ÿå§“å</option>
                        <option value="date">æŒ‰é¢„çº¦æ—¥æœŸ</option>
                        <option value="all">æŸ¥è¯¢æ‰€æœ‰</option>
                    </select>
                </div>
                <div class="form-group" id="queryPhoneGroup">
                    <label>æ‚£è€…æ‰‹æœºå·:</label>
                    <input type="text" id="queryPhone" value="13800138000" placeholder="æ‚£è€…æ‰‹æœºå·">
                </div>
                <div class="form-group" id="queryDoctorGroup" style="display:none;">
                    <label>åŒ»ç”Ÿå§“å:</label>
                    <input type="text" id="queryDoctor" value="ç‹åŒ»ç”Ÿ" placeholder="åŒ»ç”Ÿå§“å">
                </div>
                <div class="form-group" id="queryDateGroup" style="display:none;">
                    <label>é¢„çº¦æ—¥æœŸ:</label>
                    <input type="date" id="queryDate" value="2024-03-15">
                </div>
                <button onclick="queryAppointments()">æŸ¥è¯¢é¢„çº¦</button>
                <div id="queryResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- SQLæŸ¥è¯¢ -->
            <div class="section">
                <h2>ğŸ—„ï¸ SQLæŸ¥è¯¢</h2>
                <div class="form-group">
                    <label>SQLè¯­å¥:</label>
                    <textarea id="sqlQuery" rows="3" placeholder="SELECT COUNT(*) FROM users">SELECT COUNT(*) as total_users FROM users</textarea>
                </div>
                <button onclick="executeSql()">æ‰§è¡ŒæŸ¥è¯¢</button>
                <button onclick="loadPresetQuery('users')">ç”¨æˆ·ç»Ÿè®¡</button>
                <button onclick="loadPresetQuery('appointments')">é¢„çº¦ç»Ÿè®¡</button>
                <button onclick="loadPresetQuery('doctors')">åŒ»ç”Ÿåˆ—è¡¨</button>
                <div id="sqlResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- æ‚£è€…æ³¨å†Œ -->
            <div class="section">
                <h2>ğŸ“ æ‚£è€…æ³¨å†Œ</h2>
                <div class="form-group">
                    <label>å§“å:</label>
                    <input type="text" id="patientName" placeholder="æ‚£è€…å§“å">
                </div>
                <div class="form-group">
                    <label>æ‰‹æœºå·:</label>
                    <input type="text" id="patientPhoneReg" placeholder="æ‰‹æœºå·">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="password" id="patientPassword" placeholder="å¯†ç ">
                </div>
                <div class="form-group">
                    <label>å‡ºç”Ÿæ—¥æœŸ:</label>
                    <input type="date" id="patientBirthDate" value="1990-01-01">
                </div>
                <div class="form-group">
                    <label>èº«ä»½è¯å·:</label>
                    <input type="text" id="patientIdCard" placeholder="èº«ä»½è¯å·">
                </div>
                <div class="form-group">
                    <label>é‚®ç®±:</label>
                    <input type="email" id="patientEmail" placeholder="é‚®ç®±åœ°å€">
                </div>
                <button onclick="registerPatient()">æ³¨å†Œæ‚£è€…</button>
                <div id="registerResponse" class="response" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸAPIå®¢æˆ·ç«¯ç±»
        class MedicalAPIClient {
            constructor(host = '8.140.225.6', port = 55000) {
                this.host = host;
                this.port = port;
                this.baseUrl = `http://${host}:${port}`;
            }

            async sendRequest(data) {
                try {
                    // æ³¨æ„: ç”±äºæµè§ˆå™¨çš„CORSé™åˆ¶ï¼Œè¿™é‡Œæ¨¡æ‹ŸAPIè°ƒç”¨
                    // å®é™…ä½¿ç”¨æ—¶éœ€è¦é…ç½®ä»£ç†æˆ–ä½¿ç”¨WebSocket
                    
                    console.log('å‘é€è¯·æ±‚:', data);
                    
                    // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // æ¨¡æ‹Ÿå“åº”æ•°æ®
                    return this.mockResponse(data);
                    
                } catch (error) {
                    console.error('è¯·æ±‚å¤±è´¥:', error);
                    throw error;
                }
            }

            mockResponse(data) {
                // æ¨¡æ‹ŸæœåŠ¡å™¨å“åº”
                const response = {
                    status: 'success',
                    timestamp: new Date().toISOString(),
                    result: null
                };

                if (data.login) {
                    response.result = data.user_name === '13800138000' && data.password === 'hash_patient1' 
                        ? 'verificationSuccess' : 'verificationFalse';
                } else if (data.query_doctor_info) {
                    response.result = {
                        status: 'success',
                        doctor_info: {
                            doctor_id: 1,
                            name: data.doctor_name,
                            department: 'å†…ç§‘',
                            fee: 50.0,
                            is_available: true
                        }
                    };
                } else if (data.create_appointment) {
                    response.result = {
                        status: 'success',
                        appointment_info: {
                            appointment_id: Math.floor(Math.random() * 1000),
                            queue_number: Math.floor(Math.random() * 10) + 1,
                            status: 'pending'
                        }
                    };
                } else if (data.query_appointments) {
                    response.result = {
                        status: 'success',
                        appointments: [
                            {
                                appointment_id: 1,
                                patient_name: 'å¼ ä¸‰',
                                doctor_name: 'ç‹åŒ»ç”Ÿ',
                                appointment_time: '2024-03-01 10:00:00',
                                status: 'pending'
                            }
                        ]
                    };
                } else if (data.sql_query) {
                    response.result = {
                        columns: ['count'],
                        data: [[Math.floor(Math.random() * 100)]]
                    };
                } else if (data.register_patient) {
                    response.result = 'chenggongcharu';
                } else {
                    response.result = 'æ“ä½œæˆåŠŸ';
                }

                return response;
            }
        }

        const client = new MedicalAPIClient();

        // æ˜¾ç¤ºå“åº”ç»“æœ
        function showResponse(elementId, response, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'response error' : 'response success';
            element.textContent = JSON.stringify(response, null, 2);
        }

        // ç”¨æˆ·ç™»å½•
        async function testLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await client.sendRequest({
                    login: true,
                    user_name: username,
                    password: password
                });
                showResponse('loginResponse', response);
            } catch (error) {
                showResponse('loginResponse', { error: error.message }, true);
            }
        }

        // æŸ¥è¯¢åŒ»ç”Ÿä¿¡æ¯
        async function queryDoctor() {
            const doctorName = document.getElementById('doctorName').value;

            try {
                const response = await client.sendRequest({
                    query_doctor_info: true,
                    doctor_name: doctorName
                });
                showResponse('doctorResponse', response);
            } catch (error) {
                showResponse('doctorResponse', { error: error.message }, true);
            }
        }

        // åˆ›å»ºé¢„çº¦
        async function createAppointment() {
            const patientPhone = document.getElementById('patientPhone').value;
            const doctorName = document.getElementById('appointmentDoctor').value;
            const appointmentTime = document.getElementById('appointmentTime').value.replace('T', ' ') + ':00';
            const feePaid = parseInt(document.getElementById('feePaid').value);

            try {
                const response = await client.sendRequest({
                    create_appointment: true,
                    patient_phone: patientPhone,
                    doctor_name: doctorName,
                    appointment_time: appointmentTime,
                    fee_paid: feePaid
                });
                showResponse('appointmentResponse', response);
            } catch (error) {
                showResponse('appointmentResponse', { error: error.message }, true);
            }
        }

        // æŸ¥è¯¢é¢„çº¦
        async function queryAppointments() {
            const queryType = document.getElementById('queryType').value;
            const requestData = { query_appointments: true };

            switch (queryType) {
                case 'phone':
                    requestData.patient_phone = document.getElementById('queryPhone').value;
                    break;
                case 'doctor':
                    requestData.doctor_name = document.getElementById('queryDoctor').value;
                    break;
                case 'date':
                    requestData.appointment_date = document.getElementById('queryDate').value;
                    break;
            }

            try {
                const response = await client.sendRequest(requestData);
                showResponse('queryResponse', response);
            } catch (error) {
                showResponse('queryResponse', { error: error.message }, true);
            }
        }

        // æ‰§è¡ŒSQLæŸ¥è¯¢
        async function executeSql() {
            const sqlQuery = document.getElementById('sqlQuery').value;

            try {
                const response = await client.sendRequest({
                    sql_query: sqlQuery
                });
                showResponse('sqlResponse', response);
            } catch (error) {
                showResponse('sqlResponse', { error: error.message }, true);
            }
        }

        // åŠ è½½é¢„è®¾æŸ¥è¯¢
        function loadPresetQuery(type) {
            const queries = {
                users: 'SELECT COUNT(*) as total_users FROM users',
                appointments: 'SELECT status, COUNT(*) as count FROM appointments GROUP BY status',
                doctors: 'SELECT name, department, fee FROM doctors WHERE is_available = 1'
            };
            document.getElementById('sqlQuery').value = queries[type];
        }

        // æ‚£è€…æ³¨å†Œ
        async function registerPatient() {
            const name = document.getElementById('patientName').value;
            const phone = document.getElementById('patientPhoneReg').value;
            const password = document.getElementById('patientPassword').value;
            const birthDate = document.getElementById('patientBirthDate').value;
            const idCard = document.getElementById('patientIdCard').value;
            const email = document.getElementById('patientEmail').value;

            if (!name || !phone || !password) {
                showResponse('registerResponse', { error: 'è¯·å¡«å†™å¿…å¡«å­—æ®µ' }, true);
                return;
            }

            try {
                const response = await client.sendRequest({
                    register_patient: true,
                    name: name,
                    password_hash: password, // å®é™…åº”ç”¨ä¸­éœ€è¦å“ˆå¸Œå¤„ç†
                    phone: phone,
                    birth_date: birthDate,
                    id_card: idCard,
                    email: email
                });
                showResponse('registerResponse', response);
            } catch (error) {
                showResponse('registerResponse', { error: error.message }, true);
            }
        }

        // åˆ‡æ¢æŸ¥è¯¢å­—æ®µæ˜¾ç¤º
        function toggleQueryFields() {
            const queryType = document.getElementById('queryType').value;
            const phoneGroup = document.getElementById('queryPhoneGroup');
            const doctorGroup = document.getElementById('queryDoctorGroup');
            const dateGroup = document.getElementById('queryDateGroup');

            phoneGroup.style.display = queryType === 'phone' ? 'block' : 'none';
            doctorGroup.style.display = queryType === 'doctor' ? 'block' : 'none';
            dateGroup.style.display = queryType === 'date' ? 'block' : 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ¨¡æ‹Ÿè¿æ¥çŠ¶æ€æ£€æŸ¥
            setTimeout(() => {
                document.getElementById('serverStatus').textContent = 'å·²è¿æ¥ (æ¨¡æ‹Ÿ)';
                document.getElementById('serverStatus').style.color = 'green';
            }, 1000);
        });
    </script>
</body>
</html>
